<!doctype html>
<html lang="en">

<head>
    <title>Leaflet Routing Machine Example with Fast Routing API</title>

    <meta charset="UTF-8" />
    <meta name="Robots" content="index,follow,noarchive" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@latest/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/leaflet.icon.glyph@0.2.0/Leaflet.Icon.Glyph.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            outline: 0;
            width: 100%;
            height: 100%;
        }

        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script type="text/javascript">
        function getBrowserLocales(options = {}) {
            var defaultOptions = {
                languageCodeOnly: false,
            };

            var opt = {
                ...defaultOptions,
                ...options,
            };

            var browserLocales =
                navigator.languages === undefined
                    ? new Array(navigator.language)
                    : navigator.languages;

            if (!browserLocales) {
                return undefined;
            }

            return browserLocales.map(function (locale) {
                var trimmedLocale = locale.trim();

                return opt.languageCodeOnly
                    ? trimmedLocale.split(/-|_/)[0]
                    : trimmedLocale;
            });
        }
        unitsystem = 'metric';
        var browserLangs = getBrowserLocales();
        var browserLangsShort = getBrowserLocales({ languageCodeOnly: true });
        var lang = 'en';
        var supportedLangs = ['ar', 'da', 'de', 'en', 'eo', 'es-ES', 'es', 'fi', 'fr', 'he', 'hu', 'id', 'it', 'ja', 'ko', 'my', 'nl', 'no', 'pl', 'pt-BR', 'pt-PT', 'ro', 'ru', 'sl', 'sv', 'tr', 'uk', 'vi', 'yo', 'zh-Hans'];
        if (browserLangs !== undefined && browserLangsShort !== undefined) {
            for (i = 0; i < browserLangs.length; i++) {
                if (supportedLangs.indexOf(browserLangs[i]) != -1) {
                    lang = browserLangs[i];
                    break;
                } else if (supportedLangs.indexOf(browserLangsShort[i]) != -1) {
                    lang = browserLangsShort[i];
                    break;
                }
            }
        }
        if (browserLangs[0] == "en-US") {
            unitsystem = 'imperial';
            waypoints = [
                L.latLng(38.900226, -77.041562),
                L.latLng(40.7286, -74.005231)
            ];
        } else if (browserLangs[0] == "en-GB") {
            unitsystem = 'imperial';
            waypoints = [
                L.latLng(51.475636, -0.072613),
                L.latLng(51.49938, -0.059545)
            ];
        } else {
            unitsystem = 'metric';
            waypoints = [
                L.latLng(48.8588, 2.3469),
                L.latLng(52.3546, 4.9039)
            ];
        }
        window.LRM = {
            apiKey: '6020c86335mshe95b784272ac769p101741jsndd55ce126215',
            tileLayerUrl: 'https://retina-tiles.p.rapidapi.com/local/osm{r}/v1/{z}/{x}/{y}.png?rapidapi-key=6020c86335mshe95b784272ac769p101741jsndd55ce126215',
            osmServiceUrl: 'https://fast-routing.p.rapidapi.com/route/v1',
            geocodeServiceUrl: 'https://forward-reverse-geocoding.p.rapidapi.com/v1/'
        };
        var map = L.map('map');


        L.tileLayer(LRM.tileLayerUrl, {
            attribution: 'Routing: <a href="https://routingapi.net/" target="_blank">Fast Routing API</a>, ' + 'Geocoding: <a href="https://www.geocodingapi.net/" target="_blank">Geocoding API</a>, ' + 'Tiles: <a href="https://www.maptilesapi.com/retina-tiles/" target="_blank">Retina Tiles API</a>, ' + 'Data: <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors. ' +
                'Data uses <a href="http://opendatacommons.org/licenses/odbl/">ODbL</a> license'
        }).addTo(map);
        var control = L.Routing.control({
            units: unitsystem,
            router: L.routing.osrmv1({
                requestParameters: { 'rapidapi-key': LRM.apiKey },
                hints: false,
                language: lang,
                serviceUrl: LRM.osmServiceUrl
            }),
            plan: L.Routing.plan(waypoints, {
                createMarker: function (i, wp) {
                    return L.marker(wp.latLng, {
                        draggable: true,
                        icon: L.icon.glyph({ glyph: String.fromCharCode(65 + i) })
                    });
                },
                geocoder: L.Control.Geocoder.nominatim({ serviceUrl: LRM.geocodeServiceUrl, geocodingQueryParams: { 'rapidapi-key': '6020c86335mshe95b784272ac769p101741jsndd55ce126215', 'accept-language': lang }, reverseQueryParams: { 'rapidapi-key': '6020c86335mshe95b784272ac769p101741jsndd55ce126215', 'accept-language': lang } }),
                routeWhileDragging: true
            }),
            hints: false,
            routeWhileDragging: true,
            routeDragTimeout: 250,
            showAlternatives: true,

            altLineOptions: {
                styles: [
                    { color: 'black', opacity: 0.15, weight: 9 },
                    { color: 'white', opacity: 0.8, weight: 6 },
                    { color: 'blue', opacity: 0.5, weight: 2 }
                ]
            }
        })
            .addTo(map)
            .on('routingerror', function (e) {
                try {
                    map.getCenter();
                } catch (e) {
                    map.fitBounds(L.latLngBounds(waypoints));
                }

                handleError(e);
            });

        L.Routing.errorControl(control).addTo(map);
        function handleError(e) {
            if (e.error.status === -1) {
                // HTTP error, show our error banner
                document.querySelector('#osrm-error').style.display = 'block';
                L.DomEvent.on(document.querySelector('#osrm-error-close'), 'click', function (e) {
                    document.querySelector('#osrm-error').style.display = 'none';
                    L.DomEvent.preventDefault(e);
                });
            }
        }
    </script>
</body>

</html>